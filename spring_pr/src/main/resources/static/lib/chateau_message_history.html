<link rel="import" href="chateau_cube_spinner.html">
<dom-module id="chateau-message-history">
    <style>
        #messageslist {
            height: 100%;
            width: 100%;
            overflow-y: scroll;
            overflow-wrap: break-word;
            /* to disable dots*/
            list-style-type: none;
        }

        #messageslist > ::content .messagediv {
            display: flex;
        }

        #messageslist > ::content .messagediv > div {
            margin: 4px;
            padding: 4px;
        }

        #messageslist > ::content .usernamediv {
            min-width: 80px;
            text-align: right;
        }

        #messageslist > ::content .textdiv {
            min-width: 200px;
            width: 100%;
            text-align: left;
        }

        #messageslist > ::content .mymessagetextdiv {
            background-color: #fefee1;
        }

        #messageslist > ::content .alienmessagetextdiv {
            background-color: azure;
        }

        #messageslist > ::content .datediv {
            min-width: 80px;
            text-align: right;
            vertical-align: middle;
        }
    </style>
    <template>
        <ul id="messageslist"></ul>
    </template>
    <script>
        Polymer({
            is: 'chateau-message-history',
            properties: {
                //Displays a message of the person who uses the client.
                // Returns a function that can be used to mark a message as it has been delivered.
                draw_new_my_message_function: {
                    type: Object,
                    notify: true
                },
                //Displays messages of other people.
                draw_new_message_function: {
                    type: Object,
                    notify: true
                }
            },
            ready: function () {
                console.log("chateau-message-history is ready.");
                var element = this;
                this.draw_new_my_message_function = function (messagemap) {
                    var ul = element.$.messageslist;
                    var li = document.createElement("li");
                    var usernameDiv = document.createElement("div");
                    usernameDiv.appendChild(document.createTextNode(""));
                    usernameDiv.className = 'usernamediv';
                    var textDiv = document.createElement("div");
                    textDiv.appendChild(document.createTextNode(messagemap.content));
                    textDiv.className = 'textdiv mymessagetextdiv';
                    var chateauCureSpinner = document.createElement("chateau-cube-spinner");
                    var dateDiv = document.createElement("div");
                    //dateDiv.appendChild(document.createTextNode(messagemap.date));
                    //the spinner must be removed after the message is sent.
                    dateDiv.appendChild(chateauCureSpinner);
                    dateDiv.className = 'datediv';
                    var messageDiv = document.createElement("div");
                    messageDiv.appendChild(textDiv);
                    messageDiv.appendChild(usernameDiv);
                    messageDiv.appendChild(dateDiv);
                    messageDiv.className = 'messagediv';
                    li.appendChild(messageDiv);
                    ul.appendChild(li);
                    element.$.messageslist.scrollTop = element.$.messageslist.scrollHeight;
                    return {
                        markAsRead: function () {
                            dateDiv.remove(chateauCureSpinner);
                        }
                    };
                };
                this.draw_new_message_function = function (messagemap) {
                    var ul = element.$.messageslist;
                    var li = document.createElement("li");
                    var usernameDiv = document.createElement("div");
                    usernameDiv.appendChild(document.createTextNode(messagemap.username + ":"));
                    usernameDiv.className = 'usernamediv';
                    var textDiv = document.createElement("div");
                    textDiv.appendChild(document.createTextNode(messagemap.content));
                    textDiv.className = 'textdiv alienmessagetextdiv';
                    var dateDiv = document.createElement("div");
                    dateDiv.appendChild(document.createTextNode(messagemap.date));
                    dateDiv.className = 'datediv';
                    var messageDiv = document.createElement("div");
                    messageDiv.appendChild(usernameDiv);
                    messageDiv.appendChild(textDiv);
                    messageDiv.appendChild(dateDiv);
                    messageDiv.className = 'messagediv';
                    li.appendChild(messageDiv);
                    ul.appendChild(li);
                    element.$.messageslist.scrollTop = element.$.messageslist.scrollHeight;
                };
            }
        });
    </script>
</dom-module>